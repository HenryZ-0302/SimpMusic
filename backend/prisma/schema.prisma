// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 用户表
model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  nickname      String?
  avatar        String?
  isAdmin       Boolean  @default(false)
  isBanned      Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // 关联
  favorites     Favorite[]
  playlists     Playlist[]
  playHistory   PlayHistory[]
  settings      UserSettings?
}

// 用户设置
model UserSettings {
  id                String   @id @default(uuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // 基本设置
  quality           String   @default("high")
  language          String   @default("en")
  saveHistory       Boolean  @default(true)
  
  // 下载设置
  downloadQuality      String   @default("high")
  videoDownloadQuality String   @default("high")
  videoQuality         String   @default("high")
  
  // 播放设置
  normalizeVolume    Boolean  @default(false)
  skipSilent         Boolean  @default(false)
  saveStateOfPlayback Boolean @default(true)
  crossfadeEnabled  Boolean  @default(false)
  crossfadeDuration Int      @default(0)
  
  // 音乐功能
  sponsorBlockEnabled Boolean @default(false)
  enableTranslateLyric Boolean @default(false)
  lyricsProvider     String   @default("simpmusic")
  translationLanguage String  @default("en")
  aiProvider         String   @default("gemini")
  useAITranslation   Boolean  @default(false)
  
  // UI设置
  translucentBottomBar Boolean @default(true)
  blurPlayerBackground Boolean @default(true)
  blurFullscreenLyrics Boolean @default(false)
  enableLiquidGlass    Boolean @default(false)
  explicitContentEnabled Boolean @default(false)
  homeLimit            Int     @default(10)
  
  // 其他
  watchVideoInsteadOfPlayingAudio Boolean @default(false)
  keepYouTubePlaylistOffline      Boolean @default(false)
  automatchType                   String?
  
  updatedAt         DateTime @updatedAt
}

// 收藏歌曲
model Favorite {
  id            String   @id @default(uuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  videoId       String
  title         String
  artist        String?
  thumbnail     String?
  duration      Int?
  
  createdAt     DateTime @default(now())

  @@unique([userId, videoId])
}

// 播放列表
model Playlist {
  id            String   @id @default(uuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  description   String?
  thumbnail     String?
  isPublic      Boolean  @default(false)
  
  songs         PlaylistSong[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// 播放列表歌曲
model PlaylistSong {
  id            String   @id @default(uuid())
  playlistId    String
  playlist      Playlist @relation(fields: [playlistId], references: [id], onDelete: Cascade)
  
  videoId       String
  title         String
  artist        String?
  thumbnail     String?
  duration      Int?
  order         Int      @default(0)
  
  createdAt     DateTime @default(now())

  @@unique([playlistId, videoId])
}

// 播放历史
model PlayHistory {
  id            String   @id @default(uuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  videoId       String
  title         String
  artist        String?
  thumbnail     String?
  duration      Int?
  
  playedAt      DateTime @default(now())

  @@index([userId, playedAt])
}

// 统计表（用于管理员）
model DailyStats {
  id            String   @id @default(uuid())
  date          DateTime @unique @db.Date
  
  totalUsers    Int      @default(0)
  newUsers      Int      @default(0)
  activeUsers   Int      @default(0)
  totalPlays    Int      @default(0)
  
  createdAt     DateTime @default(now())
}

// 公告（管理员发布）
model Announcement {
  id            String   @id @default(uuid())
  title         String
  content       String
  isActive      Boolean  @default(true)
  priority      Int      @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// 同步的 Album (YouTube Library)
model SyncedAlbum {
  id          String   @id @default(uuid())
  browseId    String   // YouTube Album ID
  title       String
  artist      String?
  thumbnail   String?
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())

  @@unique([userId, browseId]) // 防止重复
}

// 同步的 Artist (YouTube Library)
model SyncedArtist {
  id          String   @id @default(uuid())
  channelId   String   // YouTube Channel ID
  name        String
  thumbnail   String?
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())

  @@unique([userId, channelId])
}

// 同步的 YouTube Playlist (YouTube Library)
model SyncedYouTubePlaylist {
  id          String   @id @default(uuid())
  playlistId  String   // YouTube Playlist ID
  title       String
  thumbnail   String?
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())

  @@unique([userId, playlistId])
}
